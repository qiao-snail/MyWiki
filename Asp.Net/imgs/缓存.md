# Asp.Net MVC 缓存

## Output Cache

Output Cache可以缓存Controller下Action的返回值。这样，请求同样的内容，就不需要每次都去执行Controlller，Action。

假设你需要展示数据库中一些记录数据。通常来说，每当用户访问该页面的时候，应用程序都会去查询数据库，生成数据，返回html或json。如果该页面更多的情况下是用来展示的，那么就可以使用缓存，把这些数据给缓存起来。不再去执行数据库和action的操作。以此来提高应用程序的性能。

### 使用Output Cache

可以在Controller或者Action上添加`[OutputCache]`特性，使得被添加的Controller或Action可以缓存数据数据。

如下代码:缓存名为Index的Action的返回数据10秒。（绝对时间）

```CSharp
using System.Web.Mvc;

namespace MvcApplication1.Controllers
{
    [HandleError]
    public class HomeController : Controller
    {
        [OutputCache(Duration=10, VaryByParam="none")]
        public ActionResult Index()
        {
            return View();
        }
    }
}
```
该缓存只适用于完整的URL，`http://wwww.mysite.com/home/index`来起作用。`http://www.mysite.com/`就不起作用。

不能保证内容会在指定的时间内被缓存。当内存资源变得很低时，缓存就会自动地将内容逐出。

不管是在地址栏里输入home/index还是点击刷新按钮，去请求服务端的Index action。页面展示的时间，在10秒内并不会有变化，且在这10秒内不会出发Index Action。因为该页面被缓存起来了，直到该缓存失效，才会重新执行Index Action。

此时该页面的缓存是对所有访问该页面的用户都有效，并不针对特定用户。

### 缓存位置

`OutputCache`使缓存的内容一般放在三个位置上：服务端，代理服务器，浏览器客户端。通过Loaction属性可以设置缓存的位置。

Loaction属性有如下值：

* Any
* Client
* Downstream
* Server
* None
* ServerAndClient

`Loaction`属性的默认值为`Any`。但是应该根据不同的情况使用不同的缓存位置。比如：要缓存的内容是针对特定用户的，每个用户都会不同。这样的话，该缓存就不能保存在服务器上。应该保存在浏览器客户端上。